#!/usr/bin/env lsc

require! {
  commander
  \../src/netns
}

commander
  .usage '[options]'
  .option '-i, --ip <ip>' 'ip to create namespace'
  .parse process.argv

# sanity checks
ip-re = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/
unless commander.ip and commander.ip.match ip-re
  console.error 'invalid ip address'
  process.exit 1

ns = new netns commander.ip
(err) <- ns.create
if err
  console.error err
  process.exit 1
console.log '`-create'
(err) <- ns.test
if err
  console.error err
  process.exit 1
console.log '`-test'
(err) <- ns.delete
if err
  console.error err
  process.exit 1
console.log '`-delete'

# vim:ft=ls fdm=indent
